<!DOCTYPE html>
<html>
<head>
  <meta charset="UFT-8">
  <title>D3</title>
  <link rel="stylesheet" type="text/css" href="main.css">
  <script src="https://d3js.org/d3.v5.js"></script>
  <script src="https://d3js.org/d3-queue.v3.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
</head>
<body id="body">
  <p>hi</p>
  <svg width="700" height="700">
    
  </svg>
</body>
<script>
  var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

  Promise.all([
    d3.json('data.json'),
    d3.json('countries.geo.json')
  ]).then(showData)
  
  // d3.json('countries.geo.json').then(showData)

  function showData(datasources) {
    let data = datasources[0];
    let mapInfo = datasources[1];
    let bodyHeight = 700;
    let bodyWidth = 700;

    // console.log(datasources)

    let dataIndex = {};
    for (let i = 0; i < data.length; i ++){
      // console.log(data[i]);
      let c = data[i];
      let country = c.country;
      dataIndex[country] = c.total
    }
    
    mapInfo.features = mapInfo.features.map( d => {
      let country = d.properties.name
      let total = dataIndex[country]
      d.properties.total = total;
      return d;
    })
    // console.log(mapInfo)
    let maxTotal = d3.max(mapInfo.features, d => d.properties.total);
    let median = d3.median(mapInfo.features, d => d.properties.total);

     let colorScale = d3.scaleLinear()
     .domain([0, median, maxTotal])
     .range(["white", "orange", "red"]);


    let projection = d3.geoNaturalEarth1()
      .scale(100)
      .translate([bodyWidth / 2, bodyHeight / 2])

    let path = d3.geoPath()
      .projection(projection)


    svg.selectAll("path").data(mapInfo.features)
      .enter().append("path")
      .attr("d", d => path(d))
      .attr("stroke", "black")
      .attr("fill", 
      d =>  d.properties.total ?
        colorScale(d.properties.total) : 
        "white"
      )
  }

</script>

 <script src="app.js"></script>
</html>
